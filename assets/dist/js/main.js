let AddressesList = [
    [
        {
            "sector": "4",
            "address": "Бауманская улица, 27, Москва",
            "lat": "55.773998",
            "lon": "37.678755"
        },
        {
            "sector": "4А",
            "address": "улица Дмитриева, 4, Балашиха, Московская область",
            "lat": "55.832402",
            "lon": "37.923982", 
        },
        {
            "sector": "5",
            "address": "улица Плющева, 17к1, Москва",
            "lat": "55.739275",
            "lon": "37.762012"
        },
        {
            "sector": "5А",
            "address": "улица Разина, 6с1, Балашиха, Московская область",
            "lat": "55.790150",
            "lon": "37.930015"
        },
        {
            "sector": "6",
            "address": "Краснодонская улица, 39А, Москва",
            "lat": "55.675077",
            "lon": "37.749535"
        },
        {
            "sector": "6А",
            "address": "улица Калинина, 29/5, рабочий посёлок Малаховка, городской округ Люберцы, Московская область,",
            "lat": "55.635493",
            "lon": "37.978597"
        },
        // {
        //     "sector": "6Б",
        //     "address": "Дунайская улица, 11, Раменское, Московская область, 140104",
        //     "lat": "55.563391",
        //     "lon": "38.211381"
        // },
        {
            "sector": "7",
            "address": "Домодедовская улица, 1к3, Москва",
            "lat": "55.614643",
            "lon": "37.707566"
        },
        {
            "sector": "7А",
            "address": "Белокаменное шоссе, 7, Видное, Ленинский городской округ, Московская область",
            "lat": "55.551359",
            "lon": "37.742941"
        }
        // {
        //     "sector": "7Б",
        //     "address": "деревня Галушино, 2, Раменский городской округ, Московская область",
        //     "lat": "55.447121",
        //     "lon": "37.986268"
        // },
        // {
        //     "sector": "Домодедово",
        //     "address": "улица Кирова, 3к1, микрорайон Центральный, Домодедово, Московская область",
        //     "lat": "55.441200",
        //     "lon": "37.749196"
        // },
        // {
        //     "sector": "Раменское",
        //     "address": "улица Приборостроителей, 12, Раменское, Московская область",
        //     "lat": "55.573575",
        //     "lon": "38.248613"
        // },
        // {
        //     "sector": "Жуковский",
        //     "address": "улица Ломоносова, 16, Жуковский, Московская область",
        //     "lat": "55.595433",
        //     "lon": "38.118547"
        // }
    ],
    [
        {
            "sector": "16",
            "address": "Малая Бронная улица, 12с4, Москва",
            "lat": "55.761234",
            "lon": "37.597082"
        },
        {
            "sector": "10",
            "address": "улица Маршала Тухачевского, 58, Москва",
            "lat": "55.784830",
            "lon": "37.458526"
        },
        {
            "sector": "10А",
            "address": "деревня Барвиха, 78А, Одинцовский городской округ, Московская область",
            "lat": "55.748736",
            "lon": "37.290289"
        },
        // {
        //     "sector": "10Б",
        //     "address": "коттеджный посёлок Монолит, 103, деревня Воронино, городской округ Истра, Московская область",
        //     "lat": "55.788029",
        //     "lon": "37.003673"
        // },
        {
            "sector": "9",
            "address": "микрорайон Ленинские Горы, 1с10, район Раменки, Западный административный округ, Москва",
            "lat": "55.702840",
            "lon": "37.522387"
        },
        {
            "sector": "9А",
            "address": "деревня Переделки, 18, Одинцовский городской округ, Московская область",
            "lat": "55.665086",
            "lon": "37.329141"
        },
        // {
        //     "sector": "9-Б1",
        //     "address": "улица Текстильщиков, 3к3, Троицк, Москва",
        //     "lat": "55.490398",
        //     "lon": "37.307055"
        // },
        // {
        //     "sector": "9-Б2",
        //     "address": "деревня Митькино, 74, Одинцовский городской округ, Московская область",
        //     "lat": "55.604687",
        //     "lon": "37.101293"
        // },
        {
            "sector": "8",
            "address": "Малая Юшуньская улица, 1с1, Москва",
            "lat": "55.653782",
            "lon": "37.594010"
        },
        {
            "sector": "8А",
            "address": "3-я Павлоградская улица, 6, Москва",
            "lat": "55.544611",
            "lon": "37.577849"
        }
        // {
        //     "sector": "8-Б1",
        //     "address": "улица 50 лет ВЛКСМ, 16, Подольск, Московская область",
        //     "lat": "55.425780",
        //     "lon": "37.537525"
        // },
        // {
        //     "sector": "8-Б2",
        //     "address": "СНТ Росинка, 2, городской округ Подольск, Московская область",
        //     "lat": "55.454351",
        //     "lon": "37.402632"
        // }
    ],
    [
        {
            "sector": "1",
            "address": "Кронштадтский бульвар, 24к1с1, Москва",
            "lat": "55.847922",
            "lon": "37.510089"
        },
        {
            "sector": "1А",
            "address": "Пятницкое шоссе, 48с1, Москва",
            "lat": "55.861257",
            "lon": "37.357860"
        },
        // {
        //     "sector": "1Б",
        //     "address": "СНТ Горетовка-2, 53, городской округ Солнечногорск, Московская область",
        //     "lat": "55.958991",
        //     "lon": "37.114480"
        // },
        // {
        //     "sector": "1Б-1",
        //     "address": "Савёлкинский проезд, 4к1, Зеленоград, Москва",
        //     "lat": "55.991304",
        //     "lon": "37.216286"
        // },
        {
            "sector": "2",
            "address": "Дубнинская улица, 12к2, Москва",
            "lat": "55.864475",
            "lon": "37.569683"
        },
        {
            "sector": "2А",
            "address": "площадь Собина, 3, Долгопрудный, Московская область",
            "lat": "55.934059",
            "lon": "37.514212"
        },
        // {
        //     "sector": "2Б",
        //     "address": "улица Васильковое Поле, 001, деревня Мышецкое, городской округ Химки, Московская область",
        //     "lat": "56.037398",
        //     "lon": "37.362415"
        // },
        {
            "sector": "3",
            "address": "улица Менжинского, 23к2, Москва",
            "lat": "55.869137",
            "lon": "37.659452"
        },
        {
            "sector": "3А",
            "address": "Ярославское шоссе, 116Ас1, Мытищи, Московская область",
            "lat": "55.909812",
            "lon": "37.782126"
        },
        {
            "sector": "4А",
            "address": "Малая Бородинская улица, 1к1, деревня Бородино, городской округ Мытищи, Московская область",
            "lat": "55.922627",
            "lon": "37.661482"
        }
        // {
        //     "sector": "3Б",
        //     "address": "Янтарная улица, 27, село Марфино, городской округ Мытищи, Московская область",
        //     "lat": "56.073630",
        //     "lon": "37.535457"
        // },
        // {
        //     "sector": "4Б",
        //     "address": "улица Достоевского, 26, рабочий посёлок Лесной, городской округ Пушкинский, Московская область",
        //     "lat": "56.079906",
        //     "lon": "37.924258"
        // }
    ],
    [
    {
        "sector": "Ногинск Молния",
        "address": "Рогожская улица, 166, Ногинск, Богородский городской округ, Московская область",
        "lat": "55.850494",
        "lon": "38.422130"
    },
    // {
    //     "sector": "1-Н",
    //     "address": "Школьная улица, 5, Электроугли, Богородский городской округ, Московская область",
    //     "lat": "55.716460",
    //     "lon": "38.212987"
    // },
    {
        "sector": "2-Н",
        "address": "улица Строителей, 1, рабочий посёлок Свердловский, городской округ Лосино-Петровский, Московская область",
        "lat": "55.901902",
        "lon": "38.143471"
    },
    {
        "sector": "2-Н2",
        "address": "улица Мальцево, 34, посёлок Краснознаменский, городской округ Щёлково, Московская область",
        "lat": "55.935541",
        "lon": "37.939347"
    }
    // {
    //     "sector": "3-Н",
    //     "address": "улица Серова, 40, деревня Боровково, Богородский городской округ, Московская область",
    //     "lat": "55.989747",
    //     "lon": "38.542765"
    // },
    // {
    //     "sector": "4-Н",
    //     "address": "улица Ленина, 4А, Ликино-Дулёво, Орехово-Зуевский городской округ, Московская область",
    //     "lat": "55.706781",
    //     "lon": "38.957203"
    // }
    ]
];

function fetchData(url, sklad, index) {
    fetch(url, {
        "headers": {
            "x-access-token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjEiLCJ0eXBlIjoiY29tcGFuaWVzIiwic2VjcmV0IjoiMDViMDMxNGU4OWZjMjk5MTEwOTEzYmYxM2ExYWJiZjhhYmMwMjU2NCIsImlhdCI6MTYwNzAwMDM1MX0.E7pELaHqlRTppS3q1iQoZoj14qOtGSXXlNtl1HbhnFc"
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);

        let intervals = data.delivery.courier.cantata.days;
        // console.log(intervals);

        let serverDateShow = document.querySelector('#list-server-' + sklad + "-" + index);
        serverDateShow.insertAdjacentHTML('beforeend', `
        <li class="list-group-item subtitle">Данные полученные с сервера для проверки:</li>
        <li class="list-group-item">Наименование населенного пункта: ${data.name}</li>
        <li class="list-group-item">Название склада: ${data.info.warehouse}</li>
        <li class="list-group-item">Цена доставки: ${data.delivery.courier.cantata.price}&#8381</li>
        <li class="list-group-item">Бесплатная доставка от: ${data.delivery.courier.cantata.sumRequired}&#8381</li>
        `)

        // sumRequired необходимая сумма для бесплатной доставки

        let list = document.querySelector('#list-date-' + sklad + "-" + index);
        // console.log(list);
        for(a = 0; a < intervals.length; a++){
            if (a < 2) {
                list.insertAdjacentHTML('beforeEnd', `
                <div class="list-group-item list-group-item-action list-date-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-2">Дата: ${new Date(intervals[a].date.slice(0, -1)).toLocaleDateString()}</h6>
                    </div>
                    <div class="sectora">
                    ${intervals[a].intervals}
                    </div>
                </div>
                `)
            }
            if (a == 2) {
                list.insertAdjacentHTML('beforeEnd', `
                    <div class="collapse list-group-item list-group-item-action list-group-collapse" id="collapse-${sklad}-${index}">
                        <div class="list-group-item list-group-item-action list-date-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-2">Дата: ${new Date(intervals[a].date.slice(0, -1)).toLocaleDateString()}</h6>
                        </div>
                        <div class="sectora">
                        ${intervals[a].intervals}
                        </div>
                        </div>                
                    </div>
                    <button class="list-group-item list-group-item-action btn-show-more" onclick="changeTextBtn(this);" id="btn-show-more" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${sklad}-${index}" aria-expanded="false" aria-controls="collapseExample">Показать больше дней</button>
                `)
            }
            let listCollapse = document.querySelector('#collapse-' + sklad + "-" + index);
            if (a > 2) {
                listCollapse.insertAdjacentHTML('beforeEnd', `
                <div class="list-group-item list-group-item-action list-date-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-2">Дата: ${new Date(intervals[a].date.slice(0, -1)).toLocaleDateString()}</h6>
                    </div>
                    <div class="sectora">
                    ${intervals[a].intervals}
                    </div>
                </div>
            `)
            }
            
        }
        changeViewIntervals();
    })
    // .catch(error => {
    //     console.error(error);
    //     alert("Обратитесь к Даниилу, чтобы починил:с")
    // }
    // );
}

function changeViewIntervals() {
    parentList = document.querySelectorAll('.sectora');
    // console.log(parentList);
    for(i=0;i<parentList.length;i++) {
        parentList[i].childNodes.forEach(e => {
            let content;
            if (e.nodeType == 3 && (content = e.textContent.trim())) {
                let span = document.createElement("span");
                span.className = "intervalText";
                span.innerText = content;
                e.parentNode.replaceChild(span, e);
            }
        });
    }
    
}

function changeTextBtn(clickedElement){
    // console.log(clickedElement.innerHTML);
    clickedElement.innerHTML =
    (clickedElement.innerHTML === 'Показать больше дней') ? clickedElement.innerHTML = 'Скрыть' : clickedElement.innerHTML = 'Показать больше дней';
}

let renderSectorsVostok = false;
let renderSectorsCenter = false;
let renderSectorsSever = false;
let renderSectorsNoginsk = false;
function getIntervals(sklad) {
    bannerContent.classList.add('my-0');
    
    
    if (sklad == 'Vostok' & renderSectorsVostok == false) {
            let resultBlock = document.querySelector('#reusltBlock-Vostok');
            for (i=0;i<AddressesList[0].length;i++) {
                let link = 'https://delivery.cantata.ru/api/delivery/delivery_calc?language=RU&lat_for_zone=' + AddressesList[0][i].lat + '&lon_for_zone=' + AddressesList[0][i].lon;
                resultBlock.insertAdjacentHTML('beforeEnd', `
                <div class="col-12 col-md-3 pb-3">
                <div class="card">
                    <div class="card-body" id="card-body-${sklad}-${i}">
                        <h5 class="card-title">Сектор ${AddressesList[0][i].sector}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">${AddressesList[0][i].address}</h6>
                        <div class="list-group list-date" id="list-date-${sklad}-${i}">
                        
                        </div>
                        <ul class="list-group list-group-flush list-server" id="list-server-${sklad}-${i}">

                        </ul>
                    </div>
                </div>
                </div>
                `);
                fetchData(link, sklad, i);
            }
            renderSectorsVostok = true;
    }

    if (sklad == 'Center' & renderSectorsCenter == false) {
        let resultBlock = document.querySelector('#reusltBlock-Center');
        for (i=0;i<AddressesList[1].length;i++) {
            let link = 'https://delivery.cantata.ru/api/delivery/delivery_calc?language=RU&lat_for_zone=' + AddressesList[1][i].lat + '&lon_for_zone=' + AddressesList[1][i].lon;
                resultBlock.insertAdjacentHTML('beforeEnd', `
                <div class="col-12 col-md-3 pb-3">
                <div class="card">
                    <div class="card-body" id="card-body-${sklad}-${i}">
                        <h5 class="card-title">Сектор ${AddressesList[1][i].sector}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">${AddressesList[1][i].address}</h6>
                        <div class="list-group list-date" id="list-date-${sklad}-${i}">
                        
                        </div>
                        <ul class="list-group list-group-flush list-server" id="list-server-${sklad}-${i}">

                        </ul>
                    </div>
                </div>
                </div>
                `);
                fetchData(link, sklad, i);
        }
        renderSectorsCenter = true;
    }

    if (sklad == 'Sever' & renderSectorsSever == false) {
        let resultBlock = document.querySelector('#reusltBlock-Sever');
        for (i=0;i<AddressesList[2].length;i++) {
            let link = 'https://delivery.cantata.ru/api/delivery/delivery_calc?language=RU&lat_for_zone=' + AddressesList[2][i].lat + '&lon_for_zone=' + AddressesList[2][i].lon;
                resultBlock.insertAdjacentHTML('beforeEnd', `
                <div class="col-12 col-md-3 pb-3">
                <div class="card">
                    <div class="card-body" id="card-body-${sklad}-${i}">
                        <h5 class="card-title">Сектор ${AddressesList[2][i].sector}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">${AddressesList[2][i].address}</h6>
                        <div class="list-group list-date" id="list-date-${sklad}-${i}">
                        
                        </div>
                        <ul class="list-group list-group-flush list-server" id="list-server-${sklad}-${i}">

                        </ul>
                    </div>
                </div>
                </div>
                `);
                fetchData(link, sklad, i);
        }
        renderSectorsSever = true;
    }

    if (sklad == 'Noginsk' & renderSectorsNoginsk == false) {
        let resultBlock = document.querySelector('#reusltBlock-Noginsk');
        for (i=0;i<AddressesList[3].length;i++) {
            let link = 'https://delivery.cantata.ru/api/delivery/delivery_calc?language=RU&lat_for_zone=' + AddressesList[3][i].lat + '&lon_for_zone=' + AddressesList[3][i].lon;
                resultBlock.insertAdjacentHTML('beforeEnd', `
                <div class="col-12 col-md-3 pb-3">
                <div class="card">
                    <div class="card-body" id="card-body-${sklad}-${i}">
                        <h5 class="card-title">Сектор ${AddressesList[3][i].sector}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">${AddressesList[3][i].address}</h6>
                        <div class="list-group list-date" id="list-date-${sklad}-${i}">
                        
                        </div>
                        <ul class="list-group list-group-flush list-server" id="list-server-${sklad}-${i}">

                        </ul>
                    </div>
                </div>
                </div>
                `);
                fetchData(link, sklad, i);
        }
        renderSectorsNoginsk = true;
    }
}